
#sudo docker run -d -p 27017:27017 -v ~/data:/data/db mongo
import os
from createCSV import create_csv
from connectionDB import postPosts
from bson import ObjectId
#from werkzeug.utils import cached_property

import werkzeug
werkzeug.cached_property = werkzeug.utils.cached_property
from flask import Flask,request
from flask_restplus import Resource, Api
import json

from bson import ObjectId

import urllib.parse


app = Flask(__name__)
api = Api(app=app)
class JSONEncoder(json.JSONEncoder):
    def default(self, o):
        if isinstance(o, ObjectId):
            return str(o)
        return json.JSONEncoder.default(self, o)




@api.route("/records/<int:id>")
class Article(Resource):
    # def get(self, id):
    #     posts = db.posts
    #     #for post in posts.find():
    #      #   print(post)
    #     print(id)
    #     if  id == 0 :
    #         result =[]
    #         for post in posts.find():
    #             result.append(str(post))
    #             print(str(post))
    #             print(str(result).strip('[]'))
    #         return str(result).strip('[]')
    #     else :
    #         return str(posts.find_one({"id": id}))

    def post(self, id):
        print(request)
        data = request.json
        result = postPosts(data)
        create_csv(3,False,{})
        print('One post: {0}'.format(result.inserted_id))
        return "L'article "+ str(id)+" "+str(data["id"]) +" a été ajouter"



if __name__ == '__main__':
    app.run(host='0.0.0.0', port='8000', debug=True)